まず、各ストレージの主な特徴から見ていきましょう
Google Cloudには幅広いマネージドストレージおよびDBの選択肢があります
それぞれの特徴を把握して、設計プロセスで適切なソリューションを選択できることがアーキテクトにとって重要です
これらのサービスは、リレーショナル、NoSQL、オブジェクトストレージ、DWH、インメモリに大別できます
いずれもフルマネージドのスケーラブルなサービスで、業界トップクラスのSLAに支えられています
要件に適したストレージソリューションを選択する際は、さまざまな特徴のバランスを考慮します
たとえばデータの種類、規模、耐久性、可用性、ロケーションなどの要件があります
このモジュールで要件に基づいて、最適なソリューションを判断する方法を学びます
データストレージサービスによって、可用性SLAは異なります
サービスの可用性SLAは多くの場合、サービスの構成に依存します
たとえばCloud Storageでは、スライドに示すようにマルチリージョン、リージョン、Coldlineのうち、どのバケットを作成するかにより可用性が異なります
Cloud SpannerとFirestoreでも同様に、マルチリージョンの場合はシングルリージョンの構成よりも可用性が高くなります
ここで重要になるのが要件です
ストレージ選択の判断基準は、要件であるためです
可用性SLAは通常、１か月あたりの数値で示されます
“各月の稼働率”とは、月総分数から当月のすべてのダウンタイムの分数を差し引き、月間総分数で割った数値のことです
SLAの最新の数値については、ドキュメントをご覧ください
データの耐久性とは、データ損失の確率を意味します
ストレージソリューションによっては、耐久性はお客様との共有責任になります
Google Cloudの責任は、ハードウェアで障害が発生してもデータ損失を防ぐことです
お客様の責任は、データをバックアップすることです
たとえば、Cloud Storageは99.999999999%の耐久性を備え、バージョニングが可能ですが、バージョニングを使用するタイミングを判断するのはお客様です
オブジェクト存続期間の管理ポリシーの一環として、バージョニングを有効にして古いバージョンをアーカイブしてください
他のストレージサービスで耐久性を確保するには、通常はデータをバックアップします
ディスクのバックアップとしては、スナップショットジョブをスケジュールする必要があります
Cloud SQLでは、マシンの自動バックアップ、ポイントインタイムリカバリ、さらにオプションでフェイルオーバーサーバーを使用できます
耐久性を向上させるためには、SQL DBのバックアップも実施してください
SpannerとFirestoreでは自動レプリケーションが行われるため、Cloud Storageへのデータエクスポートジョブを実行する必要があります
データの量と読み取り/書き込みの回数は、ストレージサービスを選択する際に知っておくべき重要な情報です
BigtableやSpannerのようにノードの追加で水平スケーリングが可能なサービスもあれば、Cloud SQLやMemorystoreのようにマシンの垂直スケーリングが可能なサービスもあります
無制限で自動スケーリングできるサービスもあり、Cloud Storage、BigQuery、Firestoreがその例です
データソリューションを設計する際は、強整合性も考慮すべき重要な特徴です
強整合性のDBでは、トランザクション内ですべてのデータのコピーが更新されるため、ユーザーは読み取り時に常にcommit済みの最新のデータを取得できます
強整合性を確保できるGoogle Cloudサービスには、Cloud Storage、Cloud SQL、Spanner、Firestoreなどがあります
結果整合性のDBでは通常、同じデータの複数コピーの作成によってパフォーマンスと拡張性が確保されます
結果整合性のDBでは大量の書き込み操作に対処できますが、同期的に更新されるデータのコピーは１つだけで他のコピーは非同期で更新されるため、すべての読み取り操作で常に同じ値が読み取られるという保証はありません
データの整合性は直ちにではなく、結果的に確保されます
BigtableとMemorystoreが、Google Cloudの結果整合性データサービスの例です
データストレージソリューションを設計する際はGBあたりの総費用を計算することが財務的な影響を判断するうえで重要となります
BigtableとSpannerは膨大なデータセット向けなので、小さいデータセットでは高い費用対効果は期待できません
FirestoreでのGBあたりの費用は比較的少ないものの、読み取りと書き込みの料金を考慮する必要があります
Cloud Storageも比較的安価ですが、適しているのは特定の種類のデータに限られます
BigQueryストレージも比較的安価です
ただし、レコードへのアクセスに時間がかかりクエリの実行ごとに料金が発生します
このように、適切なストレージソリューションは簡単には判断できません
データの種類、サイズ、読み取り/書き込みパターンに応じて選択する必要があります
