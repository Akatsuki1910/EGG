前述のとおり、VMは内部と外部のIPアドレスを持つことができます
GCP Consoleで確認しましょう
[Compute Engine]のページです
これからVMを作成して、内部と外部のIPアドレスを選択するプロセスを案内します
[作成]をクリックします
名前はそのままにできます
リージョンとゾーンを選択できますが、今回はIPアドレスに注目するので下に移動して、[ネットワーキング、ディスク、セキュリティ、管理、単一テナンシー]にある、[ネットワーキング]の[ネットワークインターフェース]で鉛筆アイコンをクリックします
複数のネットワークがあればその中から選べますが、今回は該当しません
[プライマリ内部IP]と[外部IP]の項目があります
これらのオプションでエフェメラルアドレスを選択できます
自動作成を選ぶか、カスタムを選んでこの範囲内のIPアドレスを入力することもできます
静的内部IPアドレスも予約できます
予約したIPアドレスは長期間保持できるので便利です
外部IPアドレスのオプションも同様ですが、[なし]を選択できるという点が大きな違いです
前に説明したようにインスタンスの外部IPアドレスは必須ではありません
今回はエフェメラルにしておきます
ここは/20になっています
このIP範囲はかなり広く、4,000個を超えるアドレスがあります
同じ数のインスタンスを作成可能ですが、ネットワークあたりの上限数があります
この動画の録画時点では15,000個です
IP範囲が広くても、それだけの数のインスタンスを作成できるわけではありません
この割り当てのほかに、特定のリージョンまたはゾーン内で利用できる物理ハードウェアに関する制限もあります
このインスタンスを作成します
インスタンスが作成されたら、内部IPアドレスと外部IPアドレスを確認します
インスタンスをいったん停止してから起動して、IPアドレスが変わるか確かめます
これが内部IPアドレスです
前に確認した空間内にあります
外部IPアドレスも明らかにGoogleの範囲内にあります
予約はしなかったので、これはエフェメラルアドレスです
エフェメラルであることをテストするために、インスタンスを選択して停止します
90秒以内に停止しない場合、強制終了されると表示されます
シャットダウンスクリプトを使う場合は、実際に90秒以内に完了するか確認しておきましょう
作業を進めましょう
現在割り当てられている外部IPアドレスと内部IPアドレスを覚えておいてください
待っている間、[更新]をクリックして状況を確認することもできます
90秒ほどかかります
これは、シャットダウンスクリプトにインスタンスを正常に停止するためのタスクを実行する余裕を与えるための時間です
インスタンスが停止されて、外部IPが表示されなくなりました
次はインスタンスを再起動します
実行中は料金が発生すると表示されますが、問題ありません
インスタンスが停止されている間、内部IPアドレスは変わっていません
しばらくこのままの状態になります
インスタンスの起動中は進行状況をここでモニタリングできます
新しい外部IPアドレスが割り当てられるはずです
外部IPアドレスはエフェメラルだからです
インスタンスが再起動し、外部IPアドレスが変わりました
このようにすべてのVMには内部IPアドレスが必要ですが、外部IPアドレスはオプションであり、既定ではエフェメラルです
