エフェメラルアドレスと静的アドレスのどちらであっても、外部IPアドレスはVMのOSには認識されません
外部IPアドレスはVPCによって透過的にVMの内部アドレスにマッピングされます
ここに示すように、GCPのVM内でifconfigを実行すると、内部IPアドレスのみが返されます
詳しく理解するために、内部アドレスと外部アドレスのDNS解決を見ていきましょう
まずは内部アドレスです
各インスタンスには、内部IPアドレスに解決可能なホスト名があります
このホスト名はインスタンス名と同じです
インスタンスには内部完全修飾ドメイン名（FQDN）もあります
FQDNの形式はスライドに示すとおりです
インスタンスを削除して再作成すると、内部IPアドレスが変わる場合があります
これにより他のCompute Engineリソースからの接続が切断されたら、再接続するには新しいIPアドレスを取得する必要があります
ただし、内部IPアドレスが変わってもDNS名が指すインスタンスは常に同じです
各インスタンスにはそのDNSリゾルバとしても機能するメタデータサーバーがあります
このサーバーはローカルネットワークリソースに対するDNSクエリを処理し、その他のクエリはパブリック名解決のためにGoogleのパブリックDNSサーバーに転送します
前述のとおり、インスタンスは自身に割り当てられた外部IPアドレスを認識しません
代わりに、ネットワークのルックアップテーブルにインスタンスの外部IPアドレスとそれに対応する内部IPアドレスが保存されます
独自のリゾルバを設定する方法を含め、詳細は動画のリンクセクションをご覧ください
次は外部アドレスに目を向けます
外部IPアドレスを持つインスタンスにはプロジェクト外部のホストから接続できます
ユーザーは外部IPアドレスを使用して直接接続できます
インスタンスを指すパブリックDNSレコードは自動的には公開されませんが、管理者が既存のDNSサーバーを使用して公開できます
ドメインネームサーバーはCloud DNSを使ってGCP上でホストできます
これは検討に値するマネージドサービスなので、詳細を確認しましょう
Cloud DNSは拡張性と信頼性に優れた、権威ドメインネームシステム（DNS）のマネージドサービスであり、Googleと同じインフラで動作します
Cloud DNSは、google.comなどのドメイン名のリクエストをIPアドレスに変換します
Googleエニーキャストネームサーバーのグローバルネットワークを使って、世界中のあらゆる場所からお客様のDNSゾーンをサポートし、ユーザーに低レイテンシと高可用性を提供します
高可用性は重要です
ドメイン名を検索できないと、インターネットも使用できないからです
そのため、GCPでは稼働率100%のサービスレベル契約（SLA）をCloud DNSで構成されたドメインに提供しています
このSLAの詳細は動画のリンクセクションをご覧ください
Cloud DNSでは、数百万ものDNSレコードを作成、更新できます
独自のDNSサーバーやソフトウェアを管理する必要はなく、シンプルなUI、コマンドラインインターフェース、またはAPIを使用できます
Cloud DNSの詳細は動画のリンクセクションをご覧ください
GCPのネットワーキング機能にはエイリアスIP範囲もあります
この機能は内部IPアドレスの範囲をエイリアスとして、VMのネットワークインターフェースに割り当てます
VMで複数のサービスを実行している場合、この機能を使えばサービスに個別のIPアドレスを割り当てることができます
VM内でホストするコンテナやアプリを表す複数のIPアドレスを構成できるので、個別のインターフェースを定義する必要がなくなります
エイリアスIP範囲は、サブネットのプライマリまたはセカンダリCIDR範囲から取得できます
この図に示すのは、プライマリおよびセカンダリCIDR範囲と、VMエイリアスIP範囲の基本的な例です
エイリアスIP範囲の詳細については動画のリンクセクションをご覧ください
