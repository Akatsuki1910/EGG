コンピューティング、イメージ、ディスクのオプションについて学んだので、Compute Engineで行う一般的な操作を確認しましょう
すべてのVMインスタンスのメタデータはメタデータサーバーに保存されます
メタデータサーバーは、起動/シャットダウンスクリプトと組み合わせると特に便利です
メタデータサーバーを使用すれば追加の承認を行わずに、インスタンスに関する固有の情報をプログラムで取得できるからです
たとえば起動スクリプトで、インスタンスの外部IPアドレスに関するメタデータのKey-Valueペアを取得し、そのIPアドレスを使用してデータベースを設定できます
デフォルトのメタデータキーはすべてのインスタンスで同じなので、スクリプトをインスタンスごとに更新しなくてもそのまま再利用できます
これによりアプリのコードの安定性が向上します
インスタンスメタデータの保存と取得はCompute Engineでよく行われる操作です
起動/シャットダウンスクリプトはCloud Storageに保存しましょう
これについてはこのモジュールの次のラボで詳しく説明します
よく使用されるもう一つの操作は新しいゾーンへのインスタンスの移動です
たとえば地理的な理由や、ゾーンが廃止になる場合に行います
同じリージョン内でインスタンスを移動する場合は、gcloud compute instances moveコマンドで移動を自動化できます
別のリージョンにインスタンスを移動する場合は、ここで説明するプロセスに沿って手動で移動します
すべての永続ディスクのスナップショットを作成し、移動先ゾーンにそのスナップショットから新しいディスクを作成します
次に移動先ゾーンに新しいVMを作成し、新しい永続ディスクをアタッチして、静的IPを割り当ててVMへの参照をすべて更新します
最後に元のVMとそのディスク、スナップショットを削除します
次はスナップショットについて詳しく見ていきましょう
スナップショットには多くのユースケースがあり、たとえばアプリ、可用性、復旧の要件を満たすよう、耐久性の高いストレージソリューションに重要なデータをバックアップするために使用できます
スナップショットが保存されるCloud Storageについては後で説明します
ゾーン間でのデータ移行にもスナップショットを使用できます
２つのリージョン間でインスタンスを手動で移動するプロセスでも触れましたが、スナップショットを使用してゾーン間でデータを簡単に移行できます
たとえばデータを使用するゾーンで、ローカルにアタッチ可能なドライブにデータを移行することで、レイテンシを最小限に抑えられます
次に示すのはスナップショットを使用して、異なるディスクタイプにデータを移行するケースです
たとえばディスクパフォーマンスを向上させたい場合は、スナップショットを使用して標準HDD永続ディスクからSSD永続ディスクにデータを移行します
スナップショットのユースケースをいくつか紹介したので、ディスクスナップショットのコンセプトを説明しましょう
このスライドのタイトルが、「永続ディスクのスナップショット」となっているのは、スナップショットが永続ディスクでのみ利用でき、ローカルSSDでは利用できないからです
主にインスタンスの作成やインスタンステンプレートの構成に使用される公開イメージやカスタムイメージとは異なり、スナップショットは永続ディスクに保存されたデータの定期バックアップに役立ちます
スナップショットは増分的なものであり、自動的に圧縮されるため、ディスクの完全なイメージを定期的に作成するよりも、短時間かつ大幅に低い費用で永続ディスクの定期的なスナップショットを作成できます
前の例で見たように、スナップショットは新しい永続ディスクに復元できるため、新しいゾーンへの移動が可能です
永続ディスクのスナップショットの作成方法は、この動画のリンクセクションをご覧ください
Compute Engineでよく行うもう一つの操作は、永続ディスクのサイズ変更です
ストレージ容量を増やすとI/Oパフォーマンスを高めることができます
サイズ変更は実行中のVMにディスクがアタッチされていても行えます
スナップショットの作成は不要です
ディスクのサイズを増やすことはできますが、減らすことはできないのでご注意ください
