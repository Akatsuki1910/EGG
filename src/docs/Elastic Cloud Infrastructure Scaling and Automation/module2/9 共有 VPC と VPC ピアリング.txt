ハイブリッド接続からVPCネットワークの共有に話題を変えましょう
最もシンプルなクラウド環境では、１つのプロジェクトに多数のリージョンにまたがる１つのVPCネットワークがあり、VMインスタンスが非常に大規模で複雑なアプリをホストしています
しかし多くの組織は、複数のVPCネットワークとサブネットで、複数の分離されたプロジェクトをデプロイしています
このレッスンでは、複数のGCPプロジェクトでVPCネットワークを共有するための、２つの構成について説明します
まず共有VPCを取り上げます
これを使用すると、GCP組織内の複数のプロジェクトでネットワークを共有できます
次にVPCネットワークピアリングを取り上げます
これを使用すると同じ組織または異なる組織の複数のプロジェクト間での、プライベート通信を構成できます
組織は共有VPCを使用して複数のプロジェクトのリソースを、共通のVPCネットワークに接続できます
これによりリソースはそのネットワークの内部IPを使用して、相互に安全かつ効率的に通信できます
たとえばこの図では、ウェブアプリサーバーのプロジェクトに属するネットワークが１つあります
このネットワークは他の３つのプロジェクト、すなわちRecommendation Service Personalization Service Analytics Serviceと共有されています
これらのサービスプロジェクトにはそれぞれ、ウェブアプリサーバーと同じネットワーク内にインスタンスがあり、内部IPアドレスを使用してこのサーバーとプライベート通信を行えます
ウェブアプリサーバーは、サーバーの外部IPアドレスを使用して、クライアントやオンプレミスと通信します
一方バックエンドサービスは、内部IPアドレスを使用した通信のみを行うので、外部とは通信できません
共有VPCを使用する場合、１つのプロジェクトをホストプロジェクトとして指定し、他のサービスプロジェクトをホストプロジェクトに接続します
この場合、ウェブアプリサーバーのプロジェクトがホストプロジェクトで、他の３つのプロジェクトがサービスプロジェクトです
このVPCネットワーク全体を、共有VPCネットワークと呼びます
一方VPCネットワークピアリングでは、２つのVPCネットワーク間で、RFC 1918のプライベート接続を行うことができます
ネットワークが同じプロジェクトまたは、同じ組織に属しているかどうかは関係ありません
ご承知のように、各VPCネットワークではファイアウォールルールで、ネットワーク間のどのトラフィックを許可または拒否するかを定義します
たとえばこの図には、コンシューマとプロデューサーを表す２つの組織があります
各組織にはそれぞれ、固有の組織ノード、VPCネットワーク、VMインスタンスがあり、ネットワーク管理者、インスタンス管理者がいます
VPCネットワークピアリングを正常に確立するには、プロデューサー側ネットワーク管理者が自組織のネットワークをコンシューマネットワークとピアリングし、コンシューマ側ネットワーク管理者が自組織のネットワークをプロデューサーネットワークとピアリングします
両方のピアリング接続が確立されたときに、VPCネットワークピアリングセッションがアクティブになりルートが交換されます
これによりVMインスタンスが、内部IPアドレスを使用してプライベート通信を行えるようになります
VPCネットワークピアリングは、マルチプロジェクトネットワーキングの非集中型または分散型のアプローチです
各VPCネットワークは、別々の管理者グループの管理下にあり、独自のグローバルファイアウォールとルーティングテーブルを維持するからです
従来このようなプロジェクトでは、VPCネットワーク間のプライベート通信を容易にするため、外部IPアドレスまたはVPNの使用を検討します
ただしVPCネットワークピアリングでは、外部IPアドレスやVPNを使用する際に存在するネットワークレイテンシ、セキュリティ、コストの問題は発生しません
共有VPCとVPCネットワークピアリングについて説明したので、この２つの構成を比較して特定の状況にどちらが適しているのかを判断できるようにしましょう
異なる組織のVPCネットワーク間でプライベート通信を構成する場合は、VPCネットワークピアリングを使用する必要があります
共有VPCは同じ組織内でのみ機能します
同様に同じプロジェクトのVPCネットワーク間で、プライベート通信を構成する場合も、VPCネットワークピアリングを使用する必要があります
この場合ネットワークは同じプロジェクト内に存在する必要はありませんが、存在してもかまいません
共有VPCはプロジェクト間でのみ機能します
私が考える２つの構成の最大の違いは、ネットワーク管理モデルです
共有VPCは、マルチプロジェクトネットワーキングの集中型アプローチです
指定された単一のVPCネットワークで、セキュリティとネットワークポリシーが適用されるからです
一方VPCネットワークピアリングは、分散型のアプローチです
各VPCネットワークは別々の管理者グループの管理下にあり、独自のグローバルファイアウォールとルーティングテーブルを維持するからです
共有VPCとVPCピアリングについて、詳しく学びたい場合はこの動画のリンクセクションにある、「Networking in Google Cloud Platform」の受講をおすすめします
