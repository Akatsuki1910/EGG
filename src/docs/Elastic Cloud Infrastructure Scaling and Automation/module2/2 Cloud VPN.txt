Cloud VPNはお客様のオンプレミスネットワークを、GCP VPCネットワークにIPSec VPNトンネルを介して安全に接続します
２つのネットワーク間のトラフィックは、一方のVPNゲートウェイで暗号化され、もう一方のVPNゲートウェイで復号されます
これによりデータは、公共インターネットを通過する際も保護されます
そのためCloud VPNは、少量のデータ接続に適しています
マネージドサービスであるCloud VPNは、SLAで99.9%のサービス可用性を保証し、サイト間VPN、静的ルートと動的ルート、IKEv1暗号とIKEv2暗号をサポートします
クライアントコンピュータがクライアントVPNソフトウェアを使用して、VPNにダイヤルインするユースケースには、Cloud VPNは対応していません
また動的ルートはCloud Routerを使用して構成します
これは後で簡単に説明します
SLAとこれらの機能の詳細については、この動画のリンクセクションをご覧ください
Cloud VPNの例を見ていきましょう
この図はVPCネットワークと、オンプレミスネットワーク間のVPN接続を簡単に示したものです
VPCネットワークには、us-east1とus-west1にサブネットがあり、これらのリージョンそれぞれにGCPリソースがあります
ファイアウォールルールで通信が許可されている場合、ネットワーク内のルーティングは自動的に構成されるため、これらのリソースは内部IPアドレスを使用して通信できます
ここでオンプレミスネットワークとそのリソースに接続するために、Cloud VPNゲートウェイ、オンプレミスVPNゲートウェイ、２つのVPNトンネルを構成する必要があります
Cloud VPNゲートウェイは、リージョンの外部IPアドレスを使用するリージョンリソースです
オンプレミスVPNゲートウェイは、データセンター内の物理デバイスか、別のクラウドプロバイダのネットワーク内にある物理ベースまたはソフトウェアベースのVPNプロダクトです
このVPNゲートウェイも外部IPアドレスを持っています
VPNトンネルはこれらのVPNゲートウェイを接続し、暗号化されたトラフィックが通過する仮想メディアとして機能します
２つのVPNゲートウェイ間の接続を作成するには、２つのVPNトンネルを確立する必要があります
各トンネルでは、ゲートウェイの観点から接続が定義され、２つのトンネルが確立されて初めてトラフィックが通過できます
ここで、Cloud VPNを使用する際に注意すべきなのは、オンプレミスVPNゲートウェイの最大伝送単位（MTU）は、1,460バイト以下にする必要があることです
その理由はパケットの暗号化とカプセル化です
このMTUの考慮事項の詳細については、この動画のリンクセクションをご覧ください
Cloud VPNが静的ルートと動的ルートの両方に対応していることはすでにお話ししました
動的ルートを使用するには、Cloud Routerを構成する必要があります
Cloud Routerでは、Border Gateway Protocol（BGP）を使用して、Cloud VPNトンネルのルートを管理できます
このルーティング方法を使用すると、トンネル構成を変更せずにルートの更新や交換が可能になります
たとえばこの図では、VPCネットワーク内に２つの異なるリージョンサブネット、すなわちTestとProdが示されています
オンプレミスネットワークには29のサブネットがあり、２つのネットワークはCloud VPNトンネルを介して接続されます
では新しいサブネットを追加する場合、たとえばGCPネットワークにStagingというサブネットを追加し、オンプレミスに新しい10.0.30.0/24サブネットを追加して、データセンターのトラフィックの増大に対応するにはどうすればよいでしょうか
ネットワーク構成の変更を自動的に反映させるために、VPNトンネルはCloud Routerを使用して、BGPをサポートする必要があるVPCとオンプレミスVPNゲートウェイ間に、BGPセッションを確立します
新しいサブネットはネットワーク間で、シームレスにアドバタイズされます
つまり新しいサブネット内のインスタンスは、すぐにトラフィックの送受信を開始できます
これについてはこの後のラボで見ていきます
BGPを設定するには、VPNトンネルの各側に追加のIPアドレスを割り当てる必要があります
どちらのIPアドレスもIPアドレス範囲、169.254.0.0/16に属するリンクローカルIPアドレスでなければなりません
これらのアドレスは、いずれのネットワークのIPアドレス空間にも含まれず
BGPセッションを確立するためにのみ使用されます
