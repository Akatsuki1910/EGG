HTTPロードバランサの動作を確認しましょう
ここに示すプロジェクトでは、グローバルIPアドレスが１つですが、ユーザーはGoogle Cloudネットワークにそれぞれ北米とEMEAにある２つのロケーションから接続します
まず、グローバル転送ルールが受信リクエストをターゲットHTTPプロキシに転送します
プロキシはURLマップをチェックして、リクエストに適したバックエンドサービスを決定します
この例では、ゲストブックアプリに対処するバックエンドサービスは１つだけです
このサービスが使用する２つのバックエンドは、それぞれus-central1-aとeurope-west1-dにあります
各バックエンドは、マネージドインスタンスグループからなります
ロードバランシングサービスはユーザーリクエストを受信すると、ソースIPアドレスからリクエストの大まかな送信元を特定します
ロードバランシングサービスはバックエンドサービスが所有するインスタンスの、ロケーション、総容量、現在の総使用量も認識します
そのため、ユーザーに最も近いインスタンスに使用可能な容量がある場合、そのインスタンスセットにリクエストが転送されます
この例では、北米のユーザーからのトラフィックは、us-central1-aにあるマネージドインスタンスグループに転送され、EMEAのユーザーからのトラフィックはeurope-west1-dにあるマネージドインスタンスグループに転送されます
各リージョンに複数のユーザーが存在する場合、各リージョン宛ての受信リクエストは、そのリージョンで使用可能な全バックエンド、サービスとインスタンスに均等に分散されます
所定のリージョン内に使用可能な容量を備えた、正常なインスタンスがない場合、ロードバランサは代替手段として、使用可能な容量を持つ次に近いリージョンにリクエストを送信します
そのため、EMEAユーザーからのトラフィックは、europe-west1-dバックエンドに容量がないか、ヘルスチェッカーで正常と判断されたインスタンスがない場合、us-central1-aバックエンドに転送されることになります
これはクロスリージョン、ロードバランシングと呼ばれます
HTTP(S)ロードバランサのもう１つ例は、コンテンツベースのロードバランサです
この例では別個のバックエンドサービスが２つあり、それぞれウェブまたは動画のトラフィックを処理します
ロードバランサはトラフィックをURLマップに指定されたURLヘッダーに基づき分割します
ユーザーが/videoに移動すると、トラフィックはバックエンドvideo-serviceに送信され、他の場所に移動するとトラフィックはバックエンドweb-serviceに送信されます
これらはすべて単一のグローバルIPアドレスで行われます
