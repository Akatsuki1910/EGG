内部ロードバランシングについて説明します
内部TCP/UDPロードバランサは、TCPベースとUDPベースのトラフィック向けのリージョンのプライベートロードバランシングサービスです
つまりこのロードバランサを使用すると、プライベートロードバランシングIPアドレスの背後でサービスを実行、スケーリングできます
このロードバランサには、同じリージョンにあるVMインスタンスの内部IPアドレスを介してのみアクセスできます
このため内部TCP/UDPロードバランシングのIPアドレスは、プライベートバックエンドインスタンスへのフロントエンドとして機能するように構成します
ロードバランシングサービスには、パブリックIPが必要ないため、内部クライアントリクエストはVPCネットワークとリージョンの内部にとどまります
すべてのロードバランシングトラフィックがGoogleのネットワーク内にとどまり、構成が大幅に単純化されるため、一般的にレイテンシが小さくなります
SW定義の内部TCP/UDPロードバランシングサービスを使用する利点を詳しく説明します
Google Cloudの内部ロードバランシングは、デバイスやVMインスタンスに基づかないSWで定義された完全分散型のロードバランシングソリューションです
図の左側に示すように、内部ロードバランシングの従来のプロキシモデルでは、ロードバランシングデバイスまたはインスタンスに内部IPアドレスを構成し、このIPアドレスにクライアントインスタンスが接続します
このIPアドレスが受信するトラフィックはロードバランサで終端し、ロードバランサは新しい接続を確立するバックエンドを選択します
基本的に接続は２つです
１つはクライアントとロードバランサの間のもので、１つはロードバランサとバックエンドの間のものです
Google Cloudの内部ロードバランシングは、右のように別の方法でクライアントインスタンスリクエストをバックエンドに分散させます
Googleのネットワーク仮想化スタックであるAndromedaを基盤とした、軽量のロードバランシングを使用して、SWで定義されたロードバランシングを実現し、クライアントインスタンスからバックエンドインスタンスにトラフィックを直接配信しています
Andromedaについて詳しくは、この動画のリンクセクションをご覧ください
Google Cloudの内部HTTP(S)ロードバランシングは、プロキシベースのリージョンのレイヤ７ロードバランサです
内部ロードバランシングIPアドレスの背後で、サービスを実行、スケーリングできます
バックエンドサービスは、HTTP、HTTPS、HTTP/2の各プロトコルをサポートしています
内部HTTP(S)ロードバランシングは、オープンソースのEnvoyプロキシをベースにしたマネージドサービスです
HTTP(S)パラメータに基づいて、さまざまなトラフィック制御機能を有効にできます
ロードバランサの構成を終えると、トラフィックのニーズに応じて、Envoyプロキシが自動的に割り当てられます
内部ロードバランシングによって、従来の３層ウェブサービスのようなユースケースをサポートできます
この例ではウェブ層が外部HTTP(S)ロードバランサを使用して、サンフランシスコ、アイオワ、シンガポールなどのユーザーに単一のグローバルIPアドレスを提供しています
グローバルロードバランサであるため、このロードバランサのバックエンドは、us-west1、us-central1、asia-east1の各リージョンに存在します
いずれのバックエンドもアプリケーション層または内部層として、それぞれのリージョンの内部ロードバランサにアクセスします
この内部層のバックエンドは、us-west1-a、us-central1-b、asia-east1-bにあります
最後の層は、各ゾーンにあるデータベース層です
この３層アプローチの利点は、DB層もアプリケーション層も外部に公開されないことです
これによりセキュリティとネットワークの料金が簡素化されます
