Cloud Storageには他にも機能があります
今は概要の説明にとどめ、追っていくつかの機能を詳しく見ていきます
このコースシリーズですでに触れたように、永続ディスクをVMにアタッチするときに顧客指定の暗号鍵を使用できます
この方法では、Googleが管理する鍵ではなく、独自の暗号鍵を指定できます
これはCloud Storageでも有効です
オブジェクトのライフサイクル管理では、オブジェクトの削除やアーカイブが自動でできます
オブジェクトのバージョニング機能では、バケット内にオブジェクトの複数のバージョンを維持できます
バージョンは複数のファイルと同様に扱われ、料金が発生するのでご注意ください
ディレクトリ同期では、VMディレクトリをバケットと直接同期できます
オブジェクトの変更通知、データインポート、強整合性については、オブジェクトのバージョニングとライフサイクル管理の後に詳しく説明します
Cloud Storageではオブジェクトは不変です
アップロードされたオブジェクトは、保存されている間、変更できません
削除または上書きされたオブジェクトを取得できるよう、オブジェクトのバージョニング機能が用意されています
バージョニングはバケット単位で有効にできます
有効にすると、ライブオブジェクトが上書き、削除されるたびに、そのオブジェクトのアーカイブバージョンが作成されます
アーカイブバージョンのオブジェクト名は同じですが、このスライドに記載のように“g1”といった世代番号で一意に識別されます
バージョニングを有効にすると、アーカイブバージョンの一覧表示、ライブバージョンの前の状態への復元、アーカイブバージョンの完全な削除を必要に応じて行えます
バージョニングは随時、バケットに対して有効/無効にできます
無効にすると、オブジェクトの既存のバージョンが残されて、新しくアーカイブされたバージョンの蓄積が停止されます
バージョニングの詳細は、この動画のリンクセクションをご覧ください
一般的なユースケース、たとえば、オブジェクトの有効期間の設定、古いバージョンのアーカイブ、費用管理のためのストレージクラスのダウングレードには、オブジェクトのライフサイクル管理で対応できます
ライフサイクル管理の構成を、バケットに割り当てます
この構成は、バケット内の全オブジェクトに適用される一連のルールです
オブジェクトがいずれかのルールの条件に適合すると、指定のアクションをCloud Storageが自動でオブジェクトに対して実行します
ユースケースの例を紹介します
まず、１年経過したオブジェクトでは、ストレージクラスをColdlineにダウングレードします
２つ目は、特定の日付以前に作成されたオブジェクトを削除します
2017年１月１日以前などです
３つ目は、バージョニングが有効なバケットでは、各オブジェクトの最新３つのバージョンだけを保持します
オブジェクトの検査は、非同期バッチで実行されるため、ルールがすぐに適用されない場合があります
また、ライフライクル管理の構成の更新が反映されるまでに、最大24時間かかる場合があります
つまり、構成を変更してもオブジェクトのライフサイクル管理が、最大24時間は古い構成に基づいて行われることがあります
この点に注意が必要です
ライフサイクル管理の詳細は、この動画のリンクセクションをご覧ください
オブジェクトの変更通知を使うと、監視リクエストによって、オブジェクトの更新やバケットへの追加をアプリに通知できます
監視リクエストを実行すると、新しい通知チャネルが作成されます
この通知チャネル経由で、バケットを監視中のアプリに通知メッセージが送信されます
この動画の録画時点で、サポート対象の通知チャネルはWebhookのみです
通知チャネルが開始されると、Cloud Storageにより、バケット内のオブジェクトが追加、更新、削除されるたびにアプリに通知が届きます
たとえば、ここに示すようにバケットに新しい画像を追加すると、アプリに通知され、サムネイルが作成されます
ただし、オブジェクトの変更の追跡に推奨されるのはPub/Sub通知です
速度、柔軟性、設定の容易さ、費用対効率の点で優れているからです
Pub/Subは分散型リアルタイムメッセージングサービスで、「Developing Applications」コースで取り上げています
Cloud Consoleを使えば個々のファイルをバケットにアップできます
ですが、TBやPB規模のデータの場合はどうでしょう、そのための３つのサービスがあります
Transfer Appliance、Storage Transfer Service、オフラインメディアインポートです
Transfer Applianceは大量のデータを移行できるHWアプライアンスです
数百TBから最大１PBのデータを、事業運営を中断せずにGoogle Cloudに移行できます
スライドの画像がこのアプライアンスです
Storage Transfer Serviceでは、オンラインデータを高速インポートできます
データソースは別のStorageバケットでも、Amazon S3バケット、HTTPSロケーションでもかまいません
オフラインメディアインポートはサードパーティのサービスです
ストレージアレイ、HDD、テープ、USBフラッシュドライブなどの物理メディアを、プロバイダに送ってデータをアップしてもらいます
３つのサービスの詳細は、この動画のリンクセクションをご覧ください
Cloud Storageにオブジェクトをアップして、成功レスポンスを受信すると直ちに、オブジェクトのダウンロードとメタデータ操作が、Googleがサービスを提供している全ロケーションで可能になります
これは新規オブジェクトの作成にも、既存オブジェクトの上書きにも当てはまります
アップロードでは強整合性が確保されるため、read-after-writeまたはread-after-metadata-update操作に対して、404 Not Found応答や古いデータを受け取ることはありません
グローバルな強整合性は、オブジェクトの削除操作でも確保されます
削除リクエストの成功直後にオブジェクトや、そのメタデータをダウンロードしようとすると、404 Not Foundステータスコードが返されます
404エラーの原因は、削除操作の成功後はオブジェクトが存在しなくなるためです
バケットの一覧表示は強整合性の操作です
たとえばバケットを作成した直後に、バケットの一覧表示操作を行うと、返されるリストには新しいバケットが含まれます
オブジェクトの一覧表示も強整合性の操作です
オブジェクトをバケットにアップした直後に、オブジェクトの一覧操作を行うと、返されるリストには新しいオブジェクトが含まれます
