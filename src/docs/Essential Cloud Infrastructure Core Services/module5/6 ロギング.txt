Stackdriverの基礎となるのはモニタリングですが、ロギング、エラー報告、トレース、デバッグも提供されています
ここではロギングについて説明します
Stackdriver Loggingを使用すると、GCPとAWSのすべてのログデータを保存、検索、分析、モニタリングして警告できます
これは何千ものVMからアプリとシステムのログデータを取り込んで、大規模に処理できるフルマネージドサービスです
Loggingは、ログのストレージ、ログビューアと呼ばれるUI、ログをプログラムで管理するAPIで構成されます
このサービスでは、ログエントリの読み取りと書き込み、ログの検索とフィルタリング、ログベースの指標の作成が可能です
ログの保持期間は30日ですが、Cloud Storageバケット、BigQueryデータセット、Cloud Pub/Subトピックにログをエクスポートできます
30日以上保存する場合にCloud Storageはともかく、BigQueryやCloud Pub/Subにエクスポートするのはなぜでしょうか
ログをBigQueryにエクスポートすると、ログを分析してデータポータルで可視化できます
BigQueryはギガバイトからペタバイト規模のデータに対して、SQLクエリを超高速で実行します
これによりネットワークトラフィックなどのログ分析が可能になるため、トラフィックの増加を把握して容量を予測、ネットワーク使用状況を把握してトラフィック費用を最適化、ネットワークフォレンジックでインシデントを分析できます
たとえばこの図ではログを照会して、自分のウェブサーバーとやり取りしたトラフィックが特に多いIPアドレスを特定しました
そのIPアドレスの所在地や所有者をもとに、インフラの一部を再配置してネットワーク費用を節約したり、ウェブサーバーにアクセスさせたくないIPアドレスを拒否したりできます
ログを可視化する場合は、BigQueryテーブルをデータポータルに接続することをおすすめします
データポータルは、元データを指標やディメンションに変換するので、これを使用してわかりやすいレポートやダッシュボードを作成できます
お伝えしたように、ログはCloud Pub/Subにもエクスポートできます
これによりログをアプリやエンドポイントにストリーミングできます
Monitoringエージェントと同様、Loggingエージェントも全VMインスタンスにインストールすることが推奨されます
インストールにはこの２つのコマンドを使用でき、起動スクリプトに含めることができます
このエージェントは、Compute EngineとEC2のインスタンスに対応しています
